<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Monastery360 ‚Äì Monasteries</title>
<style>
  body { 
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
    text-align:center; 
    background:#faf7f2; 
    margin:0; 
    padding:20px; 
    color:#333; 
  }
  h1 { 
    margin:20px 0 10px; 
    color:#7c2d12; 
  }
  #searchBox { 
    padding:10px; 
    width:320px; 
    margin:10px auto 30px; 
    border-radius:6px; 
    border:1px solid #ccc; 
    display:block; 
  }
  .monastery-list { 
    display:flex; 
    flex-wrap:wrap; 
    justify-content:center; 
    gap:18px; 
    margin-bottom:40px; 
  }
  .monastery-card {
    position: relative;
    width:260px;
    height:180px;
    border-radius:12px;
    text-decoration:none;
    display:flex;
    align-items:flex-end;
    justify-content:center;
    font-weight:bold;
    font-size:1.1rem;
    color:white;
    text-align:center;
    background-size: cover;
    background-position: center;
    box-shadow:0 4px 12px rgba(0,0,0,0.08);
    transition: transform .18s, box-shadow .18s, background .18s;
    overflow: hidden;
  }
  .monastery-card::after {
    content: "";
    position: absolute;
    top:0; left:0; right:0; bottom:0;
    background: rgba(0,0,0,0.35); 
    border-radius:12px;
  }
  .monastery-card h3 {
    position: relative; 
    margin:0 10px 10px 10px;
    z-index:1;
    color:white;
    text-shadow: 0 2px 4px rgba(0,0,0,0.6);
  }
  .monastery-card:hover {
    transform:translateY(-6px);
    box-shadow:0 6px 18px rgba(0,0,0,0.12);
    background-color:#fef3c7;
  }
  .back-btn { 
    background:#7c2d12; 
    color:white; 
    border:none; 
    padding:12px 25px; 
    border-radius:30px; 
    text-decoration:none; 
    font-weight:bold; 
    transition:background .3s; 
  }
  .back-btn:hover { background:#b45309; }
  @media (max-width:520px){ 
    .monastery-card{ width:90%; height:160px; } 
    #searchBox{ width:90%; } 
  }

  /* Sidebar Styles */
  .sidebar { height: 100%; width: 0; position: fixed; z-index: 1000; top: 0; left: 0; background-color: #7c2d12; overflow-x: hidden; transition: 0.3s; padding-top: 60px; }
  .sidebar a { padding: 15px 25px; text-decoration: none; font-size: 1.2rem; color: white; display: block; transition: 0.3s; }
  .sidebar a:hover { background-color: #b45309; }
  .sidebar .closebtn { position: absolute; top: 20px; right: 25px; font-size: 2rem; }

  .menu-btn { position: fixed; top: 20px; left: 20px; font-size: 2rem; color: white; cursor: pointer; z-index: 1100; background:#7c2d12; border-radius:8px; padding:4px 8px; }
</style>
</head>
<body>

<!-- Menu Button -->
<span class="menu-btn" onclick="openNav()">&#9776;</span>

<!-- Sidebar -->
<div id="mySidebar" class="sidebar">
  <a href="javascript:void(0)" class="closebtn" onclick="closeNav()">&times;</a>
  <a href="index.html">Home</a>
  <a href="audio-guide.html">Audio Guide</a>
  <a href="tourism.html">Tourism Service</a>
</div>


<h1>Monasteries of Sikkim</h1>
<input id="searchBox" placeholder="Search monasteries..." type="search" />

<div class="monastery-list" id="monasteryList" aria-live="polite"></div>

<a href="index.html" class="back-btn">Back to Home</a>

<script>
const monasteries = [
  "Amba Mamring Monastery","Burtuk Ugen Pemacholing Monastery","Choten Monastery","Dichen Choling Monastery",
  "Enchey Monastery","Kathog Dorjeden Monastery","Khatek Pema Choling Monastery","Lingdok Tsangkhar Monastery",
  "Lingdum Zurmang Monastery","Old Rumtek Monastery","Pabyuik Monastery","Ralong Monastery",
  "Rumtek Dharma Chakra Centre","Samdong Mintokgang Monastery","Sang Monastery","Tsulakhang Monastery",
  "Karthok Monastery","Rhenock Monastery","Simik Monastery","Hee Gyathang Monastery","Kabi Monastery",
  "Lachen Thangu Monastery","Lachung Monastery","Lingthem Gonpa","Phensang Monastery","Phodong Monastery",
  "Ringyim Monastery","Shagyong Monastery","Singchit Ngadag Monastery","Tholung Monastery","Tingbung Monastery",
  "Chawayng Ani Monastery","Bon Monastery","Burmiok Norbugang Monastery","Doling Monastery","Kewzing Monastery",
  "Linge Phagyal Monastery","Malli Tashi Chodarling Monastery","Namthang Norbu Tsho‚ÄëLing Monastery",
  "Namtse Nga‚ÄëDag Monastery","Rabong Monastery","Sangmo Sharchog Bephug Monastery",
  "Serdup Choling Monastery","Yangang Gonpa","Namchi Monastery","Tendong Gumpa","Chakung Monastery",
  "Dodak Tamu Monastery","Dubde Monastery","Hungri Monastery","Khachoedpalri Monastery","Okhery Monastery",
  "Pemayangtse Monastery","Rinchen Choling Tamu Monastery","Rinchenpung Monastery","Sanga Choeling Monastery",
  "Silnon Monastery","Sri Badam Monastery","Tashi Samboling Tamang Monastery","Tashiding Monastery","Bermiok Monastery"
];

const listEl = document.getElementById('monasteryList');
const searchBox = document.getElementById('searchBox');

function slugify(name){
  return name.toLowerCase()
    .normalize('NFKD').replace(/[\u0300-\u036f]/g,'')   
    .replace(/['‚Äô‚Äò`"‚Äú‚Äù¬∑¬∑]/g,'')                         
    .replace(/[^a-z0-9]+/g,'-')                         
    .replace(/^-+|-+$/g,'');                            
}

function render(list){
  listEl.innerHTML = '';
  if(list.length === 0){
    listEl.innerHTML = '<p style="color:#666">No monasteries found.</p>';
    return;
  }
  list.forEach(name => {
    const file = slugify(name) + '.html';
    const a = document.createElement('a');
    a.className = 'monastery-card';
    a.href = file;
    const imgSrc = 'images/' + name + '.jpg';
    a.style.backgroundImage = `url('${imgSrc}')`;
    a.innerHTML = `<h3>${name}</h3>`;
    listEl.appendChild(a);
  });
}

render(monasteries);

searchBox.addEventListener('input', () => {
  const q = searchBox.value.trim().toLowerCase();
  if(!q){ render(monasteries); return; }
  const filtered = monasteries.filter(n => n.toLowerCase().includes(q));
  render(filtered);
});


function openNav() { document.getElementById("mySidebar").style.width = "250px"; }
function closeNav() { document.getElementById("mySidebar").style.width = "0"; }
</script>

<!-- Integrated Monastery Chatbot Widget -->
<div id="monasteryBot" class="monastery-chatbot">
  <!-- Chatbot Toggle Button -->
  <div class="chatbot-toggle" id="chatbotToggle">
    <i class="fas fa-temple-buddhist"></i>
    <div class="toggle-tooltip">Ask about monasteries</div>
  </div>

  <!-- Chatbot Window -->
  <div class="chatbot-window" id="chatbotWindow">
    <!-- Header -->
    <div class="chatbot-header">
      <div class="header-content">
        <div class="bot-avatar">
          <i class="fas fa-temple-buddhist"></i>
        </div>
        <div class="header-text">
          <h4>Monastery Guide</h4>
          <p>Ask me about Sikkim's sacred monasteries</p>
        </div>
        <button class="close-btn" id="closeChatbot">
          <i class="fas fa-times"></i>
        </button>
      </div>
    </div>

    <!-- Messages Area -->
    <div class="chatbot-messages" id="chatbotMessages">
      <div class="message bot-message welcome-message">
        <div class="message-avatar">
          <i class="fas fa-temple-buddhist"></i>
        </div>
        <div class="message-content">
          <p>üôè Namaste! I'm your monastery guide. Ask me about any monastery in Sikkim - their history, location, festivals, or visiting tips!</p>
          <div class="quick-suggestions">
            <button class="suggestion-btn" onclick="sendSuggestion('Tell me about Rumtek Monastery')">Rumtek Monastery</button>
            <button class="suggestion-btn" onclick="sendSuggestion('What are the major festivals?')">Festival Info</button>
            <button class="suggestion-btn" onclick="sendSuggestion('Best time to visit monasteries')">Best Time</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Typing Indicator -->
    <div class="typing-indicator" id="typingIndicator" style="display: none;">
      <div class="message bot-message">
        <div class="message-avatar">
          <i class="fas fa-temple-buddhist"></i>
        </div>
        <div class="message-content">
          <div class="typing-dots">
            <span></span>
            <span></span>
            <span></span>
          </div>
        </div>
      </div>
    </div>

    <!-- Input Area -->
    <div class="chatbot-input">
      <div class="input-container">
        <input type="text" id="chatbotInput" placeholder="Ask about monasteries..." maxlength="500">
        <button id="sendMessage" class="send-btn">
          <i class="fas fa-paper-plane"></i>
        </button>
      </div>
      <div class="input-footer">
        <small>Powered by AI ‚Ä¢ Monastery360</small>
      </div>
    </div>
  </div>
</div>

<style>
/* Monastery Chatbot Styles */
.monastery-chatbot {
  position: fixed;
  bottom: 2rem;
  right: 2rem;
  z-index: 10000;
  font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
}

/* Toggle Button */
.chatbot-toggle {
  width: 60px;
  height: 60px;
  background: linear-gradient(135deg, #7c2d12, #b45309);
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  box-shadow: 0 8px 25px rgba(124, 45, 18, 0.3);
  transition: all 0.3s ease;
  position: relative;
  animation: pulse 2s infinite;
}

.chatbot-toggle:hover {
  transform: translateY(-2px);
  box-shadow: 0 12px 35px rgba(124, 45, 18, 0.4);
}

.chatbot-toggle i {
  color: white;
  font-size: 1.5rem;
}

.toggle-tooltip {
  position: absolute;
  right: 70px;
  top: 50%;
  transform: translateY(-50%);
  background: rgba(0, 0, 0, 0.8);
  color: white;
  padding: 0.5rem 1rem;
  border-radius: 8px;
  font-size: 0.875rem;
  white-space: nowrap;
  opacity: 0;
  visibility: hidden;
  transition: all 0.3s ease;
}

.chatbot-toggle:hover .toggle-tooltip {
  opacity: 1;
  visibility: visible;
}

@keyframes pulse {
  0% { box-shadow: 0 8px 25px rgba(124, 45, 18, 0.3); }
  50% { box-shadow: 0 8px 25px rgba(124, 45, 18, 0.5), 0 0 0 10px rgba(124, 45, 18, 0.1); }
  100% { box-shadow: 0 8px 25px rgba(124, 45, 18, 0.3); }
}

/* Chatbot Window */
.chatbot-window {
  position: absolute;
  bottom: 80px;
  right: 0;
  width: 380px;
  height: 600px;
  background: white;
  border-radius: 20px;
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.15);
  transform: translateY(20px) scale(0.95);
  opacity: 0;
  visibility: hidden;
  transition: all 0.3s ease;
  display: flex;
  flex-direction: column;
  overflow: hidden;
}

.chatbot-window.active {
  transform: translateY(0) scale(1);
  opacity: 1;
  visibility: visible;
}

/* Header */
.chatbot-header {
  background: linear-gradient(135deg, #7c2d12, #b45309);
  padding: 1.5rem;
  color: white;
}

.header-content {
  display: flex;
  align-items: center;
  gap: 1rem;
}

.bot-avatar {
  width: 40px;
  height: 40px;
  background: rgba(255, 255, 255, 0.2);
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 1.2rem;
}

.header-text h4 {
  margin: 0;
  font-size: 1.1rem;
  font-weight: 600;
}

.header-text p {
  margin: 0;
  font-size: 0.875rem;
  opacity: 0.9;
}

.close-btn {
  margin-left: auto;
  background: none;
  border: none;
  color: white;
  font-size: 1.2rem;
  cursor: pointer;
  padding: 0.5rem;
  border-radius: 50%;
  transition: background 0.3s ease;
}

.close-btn:hover {
  background: rgba(255, 255, 255, 0.1);
}

/* Messages */
.chatbot-messages {
  flex: 1;
  overflow-y: auto;
  padding: 1rem;
  display: flex;
  flex-direction: column;
  gap: 1rem;
}

.message {
  display: flex;
  gap: 0.75rem;
  align-items: flex-start;
}

.message-avatar {
  width: 32px;
  height: 32px;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 0.875rem;
  flex-shrink: 0;
}

.bot-message .message-avatar {
  background: linear-gradient(135deg, #7c2d12, #b45309);
  color: white;
}

.user-message {
  flex-direction: row-reverse;
}

.user-message .message-avatar {
  background: #f3f4f6;
  color: #6b7280;
}

.message-content {
  background: #f8fafc;
  padding: 0.75rem 1rem;
  border-radius: 18px;
  max-width: 75%;
  word-wrap: break-word;
}

.user-message .message-content {
  background: linear-gradient(135deg, #7c2d12, #b45309);
  color: white;
}

.message-content p {
  margin: 0;
  line-height: 1.5;
}

/* Quick Suggestions */
.quick-suggestions {
  display: flex;
  flex-wrap: wrap;
  gap: 0.5rem;
  margin-top: 0.75rem;
}

.suggestion-btn {
  background: rgba(124, 45, 18, 0.1);
  border: 1px solid rgba(124, 45, 18, 0.2);
  color: #7c2d12;
  padding: 0.5rem 0.75rem;
  border-radius: 16px;
  font-size: 0.75rem;
  cursor: pointer;
  transition: all 0.3s ease;
}

.suggestion-btn:hover {
  background: rgba(124, 45, 18, 0.2);
  transform: translateY(-1px);
}

/* Typing Indicator */
.typing-dots {
  display: flex;
  gap: 4px;
  align-items: center;
}

.typing-dots span {
  width: 8px;
  height: 8px;
  background: #7c2d12;
  border-radius: 50%;
  animation: typing 1.4s infinite;
}

.typing-dots span:nth-child(2) {
  animation-delay: 0.2s;
}

.typing-dots span:nth-child(3) {
  animation-delay: 0.4s;
}

@keyframes typing {
  0%, 60%, 100% { opacity: 0.3; }
  30% { opacity: 1; }
}

/* Input Area */
.chatbot-input {
  border-top: 1px solid #e5e7eb;
  background: white;
}

.input-container {
  display: flex;
  padding: 1rem;
  gap: 0.75rem;
  align-items: center;
}

.chatbot-input input {
  flex: 1;
  border: 2px solid #e5e7eb;
  border-radius: 25px;
  padding: 0.75rem 1rem;
  font-size: 0.875rem;
  outline: none;
  transition: border-color 0.3s ease;
}

.chatbot-input input:focus {
  border-color: #7c2d12;
  box-shadow: 0 0 0 3px rgba(124, 45, 18, 0.1);
}

.send-btn {
  width: 40px;
  height: 40px;
  background: linear-gradient(135deg, #7c2d12, #b45309);
  border: none;
  border-radius: 50%;
  color: white;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: all 0.3s ease;
}

.send-btn:hover {
  transform: translateY(-1px);
  box-shadow: 0 4px 12px rgba(124, 45, 18, 0.3);
}

.send-btn:disabled {
  opacity: 0.5;
  cursor: not-allowed;
}

.input-footer {
  padding: 0.5rem 1rem;
  text-align: center;
  border-top: 1px solid #f3f4f6;
}

.input-footer small {
  color: #9ca3af;
  font-size: 0.75rem;
}

/* Mobile Responsive */
@media (max-width: 768px) {
  .monastery-chatbot {
    bottom: 1rem;
    right: 1rem;
  }
  
  .chatbot-window {
    width: calc(100vw - 2rem);
    height: 70vh;
    max-width: 350px;
  }
  
  .toggle-tooltip {
    display: none;
  }
}

/* Scrollbar Styling */
.chatbot-messages::-webkit-scrollbar {
  width: 4px;
}

.chatbot-messages::-webkit-scrollbar-track {
  background: #f1f1f1;
}

.chatbot-messages::-webkit-scrollbar-thumb {
  background: #ccc;
  border-radius: 2px;
}

.chatbot-messages::-webkit-scrollbar-thumb:hover {
  background: #999;
}
</style>

<script>
class MonasteryChatbot {
  constructor() {
    this.isOpen = false;
    this.messages = [];
    this.apiEndpoint = 'http://127.0.0.1:5000/predict'; // Flask chatbot endpoint
    
    this.initializeElements();
    this.attachEventListeners();
    this.initializeChat();
  }

  initializeElements() {
    this.toggle = document.getElementById('chatbotToggle');
    this.window = document.getElementById('chatbotWindow');
    this.closeBtn = document.getElementById('closeChatbot');
    this.messagesContainer = document.getElementById('chatbotMessages');
    this.input = document.getElementById('chatbotInput');
    this.sendBtn = document.getElementById('sendMessage');
    this.typingIndicator = document.getElementById('typingIndicator');
  }

  attachEventListeners() {
    this.toggle.addEventListener('click', () => this.toggleChat());
    this.closeBtn.addEventListener('click', () => this.closeChat());
    this.sendBtn.addEventListener('click', () => this.handleSend());
    
    this.input.addEventListener('keypress', (e) => {
      if (e.key === 'Enter') {
        this.handleSend();
      }
    });

    // Close on outside click
    document.addEventListener('click', (e) => {
      if (this.isOpen && !this.window.contains(e.target) && !this.toggle.contains(e.target)) {
        this.closeChat();
      }
    });
  }

  toggleChat() {
    if (this.isOpen) {
      this.closeChat();
    } else {
      this.openChat();
    }
  }

  openChat() {
    this.isOpen = true;
    this.window.classList.add('active');
    this.input.focus();
    
    // Track analytics
    if (typeof gtag !== 'undefined') {
      gtag('event', 'chatbot_opened', {
        event_category: 'engagement',
        event_label: 'monastery_chatbot'
      });
    }
  }

  closeChat() {
    this.isOpen = false;
    this.window.classList.remove('active');
  }

  async handleSend() {
    const message = this.input.value.trim();
    if (!message) return;

    // Add user message
    this.addMessage(message, 'user');
    this.input.value = '';
    this.sendBtn.disabled = true;

    // Show typing indicator
    this.showTyping();

    try {
      // Send to Flask chatbot API
      const response = await this.sendToAPI(message);
      this.hideTyping();
      this.addMessage(response, 'bot');
    } catch (error) {
      this.hideTyping();
      this.addMessage('Sorry, I\'m having trouble connecting. Please try again later or visit our monastery pages directly.', 'bot');
      console.error('Chatbot API Error:', error);
    }

    this.sendBtn.disabled = false;
  }

  async sendToAPI(message) {
    try {
      const response = await fetch(this.apiEndpoint, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({ message: message })
      });

      if (!response.ok) {
        throw new Error('API request failed');
      }

      const data = await response.json();
      return data.answer;
    } catch (error) {
      // Fallback responses if API is not available
      return this.getFallbackResponse(message);
    }
  }

  getFallbackResponse(message) {
    const lowerMessage = message.toLowerCase();
    
    if (lowerMessage.includes('rumtek')) {
      return 'üèõÔ∏è Rumtek Monastery is one of the most important monasteries in Sikkim! It serves as the seat of the Karmapa and houses precious Buddhist artifacts. Visit our Rumtek page for virtual tours and detailed information.';
    } else if (lowerMessage.includes('enchey')) {
      return 'üôè Enchey Monastery is a beautiful 200-year-old monastery above Gangtok, famous for its annual Cham dance festival. Check out our Enchey page for more details!';
    } else if (lowerMessage.includes('festival') || lowerMessage.includes('cham')) {
      return 'üé≠ Sikkim monasteries host amazing festivals like Losar (New Year), Saga Dawa, and spectacular Cham masked dances. Each monastery page has a cultural calendar with festival dates!';
    } else if (lowerMessage.includes('visit') || lowerMessage.includes('time')) {
      return 'üå∏ The best time to visit monasteries is March-May (spring flowers) and October-December (clear mountain views & festivals). Each monastery page has specific visiting information!';
    } else {
      return 'üôè I can help you learn about Sikkim\'s monasteries! Try asking about specific monasteries like Rumtek, Enchey, or Pemayangtse, or ask about festivals, visiting times, and locations.';
    }
  }

  addMessage(content, type) {
    const messageDiv = document.createElement('div');
    messageDiv.className = `message ${type}-message`;
    
    const avatar = document.createElement('div');
    avatar.className = 'message-avatar';
    avatar.innerHTML = type === 'bot' ? '<i class="fas fa-temple-buddhist"></i>' : '<i class="fas fa-user"></i>';
    
    const messageContent = document.createElement('div');
    messageContent.className = 'message-content';
    messageContent.innerHTML = `<p>${content}</p>`;
    
    messageDiv.appendChild(avatar);
    messageDiv.appendChild(messageContent);
    
    // Insert before typing indicator or at the end
    if (this.typingIndicator.style.display === 'none') {
      this.messagesContainer.appendChild(messageDiv);
    } else {
      this.messagesContainer.insertBefore(messageDiv, this.typingIndicator);
    }
    
    this.scrollToBottom();
  }

  showTyping() {
    this.typingIndicator.style.display = 'block';
    this.scrollToBottom();
  }

  hideTyping() {
    this.typingIndicator.style.display = 'none';
  }

  scrollToBottom() {
    setTimeout(() => {
      this.messagesContainer.scrollTop = this.messagesContainer.scrollHeight;
    }, 100);
  }

  initializeChat() {
    // Chat is initialized with welcome message in HTML
    this.scrollToBottom();
  }
}

// Quick suggestion function
function sendSuggestion(text) {
  const chatbot = window.monasteryChatbot;
  if (chatbot) {
    chatbot.input.value = text;
    chatbot.handleSend();
  }
}

// Initialize chatbot when DOM is loaded
document.addEventListener('DOMContentLoaded', function() {
  window.monasteryChatbot = new MonasteryChatbot();
});
</script>
</body>
</html>
